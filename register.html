<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Register - Book My Events</title>
  <link rel="shortcut icon" href="./logo/favicon.ico" type="image/x-icon">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    body,
    html {
      height: 100%;
      margin: 0;
      font-family: "Poppins", sans-serif;
    }

    .bg-right {
      background-image: url('https://images.pexels.com/photos/50675/banquet-wedding-society-deco-50675.jpeg?_gl=1*5mhhm7*_ga*OTQzMjkzNjEzLjE3NjE5OTQzMTY.*_ga_8JE65Q40S6*czE3NjM5OTczNTUkbzMkZzEkdDE3NjM5OTc0NTYkajMxJGwwJGgw');
      background-size: cover;
      background-position: center;
      min-height: 100vh;
    }

    .img-fluid {
      width: 270px;
      margin-left: auto;
      margin-right: auto;
      display: block;
    }

    .register-wrapper {
      justify-content: center;
      align-items: center;
      display: flex;
      flex-direction: column;
      width: 100%;
    }

    .register-form {
      max-width: 500px;
      margin-top: 30px;
      width: 100%;
    }

    .form-control {
      border-radius: 0;
      border: none;
      border-bottom: 1px solid #ccc;
      height: 48px;
    }

    .form-control:focus {
      box-shadow: none;
      border-bottom-color: #f7371d;
    }

    .btn-register {
      background: #f32626;
      border: none;
      height: 48px;
      width: 100%;
      font-size: 18px;
      font-weight: 600;
      border-radius: 5px;
      color: #fff;
    }

    .password-wrapper {
      position: relative;
    }

    .toggle-eye {
      position: absolute;
      right: 10px;
      top: 12px;
      cursor: pointer;
      font-size: 20px;
      color: #888;
    }

    .form-check-input:checked {
      background-color: #f32626 !important;
      border-color: #f32626 !important;
    }
  </style>

</head>

<body>

  <div class="container-fluid">
    <div class="row">

      <!-- LEFT SECTION -->
      <div class="col-md-6 d-flex align-items-center">
        <div class="register-wrapper">

          <!-- SAME LOGO AS LOGIN PAGE -->
           <a href="./index.html">
            <img class="img-fluid" src="assets/img/footer-logo.svg" alt="Book my event">
           </a>

          <div id="registerMsg"></div>

          <form class="register-form needs-validation" id="registerForm" novalidate>

            <div class="row">
              <div class="col-md-6 mb-4">
                <label class="mb-1">First Name</label>
                <input type="text" class="form-control" id="firstName" required>
                <div class="invalid-feedback">First name is required.</div>
              </div>

              <div class="col-md-6 mb-4">
                <label class="mb-1">Last Name</label>
                <input type="text" class="form-control" id="lastName" required>
                <div class="invalid-feedback">Last name is required.</div>
              </div>
            </div>

            <label class="mb-1">Phone Number</label>
            <input type="text" class="form-control mb-4" id="phone" required>
            <div class="invalid-feedback">Phone number is required.</div>

            <label class="mb-1">Email</label>
            <input type="email" class="form-control mb-4" id="regEmail" required>
            <div class="invalid-feedback">Valid email is required.</div>

            <label class="mb-1">Password</label>
            <div class="password-wrapper mb-4">
              <input type="password" class="form-control" id="regPassword" minlength="6" required>
              <i class="bi bi-eye toggle-eye" onclick="togglePassword('regPassword', this)"></i>
              <div class="invalid-feedback">Password must be at least 6 characters.</div>
            </div>

            <div class="form-check mb-4">
              <input class="form-check-input" type="checkbox" id="terms" required>
              <label class="form-check-label" for="terms">
                I agree with <a href="./TermsandConditions.html" class="text-danger text-decoration-none">Terms & Conditions</a>
              </label>
              <div class="invalid-feedback">You must agree before submitting.</div>
            </div>

            <button class="btn-register mb-3" type="submit">Register</button>

            <p class="mt-2">Already have an account?  
              <a class="text-decoration-none" href="login.html">Login here</a>
            </p>

          </form>

        </div>
      </div>

      <!-- RIGHT IMAGE -->
      <div class="col-md-6 bg-right d-none d-md-block"></div>

    </div>
  </div>


  <script>
    // SHOW / HIDE PASSWORD
    function togglePassword(id, icon) {
      const field = document.getElementById(id);
      const isPassword = field.type === "password";
      field.type = isPassword ? "text" : "password";

      icon.classList.toggle("bi-eye");
      icon.classList.toggle("bi-eye-slash");
    }

    // BOOTSTRAP VALIDATION
    (() => {
      const forms = document.querySelectorAll('.needs-validation');
      Array.from(forms).forEach(form => {
        form.addEventListener('submit', event => {
          if (!form.checkValidity()) {
            event.preventDefault();
            event.stopPropagation();
          }
          form.classList.add('was-validated');
        }, false);
      });
    })();

    // REGISTER API REQUEST
    document.getElementById("registerForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      if (!e.target.checkValidity()) return;

      const bodyData = {
        firstName: document.getElementById("firstName").value,
        lastName: document.getElementById("lastName").value,
        phone: document.getElementById("phone").value,
        email: document.getElementById("regEmail").value,
        password: document.getElementById("regPassword").value,
      };

      const msg = document.getElementById("registerMsg");
      msg.innerHTML = `<div class='alert alert-info'>Creating your account...</div>`;

      try {
        const res = await fetch("https://api.bookmyevent.ae/api/auth/register", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(bodyData),
        });

        const data = await res.json();

        if (res.ok) {
          msg.innerHTML = `<div class='alert alert-success'>Registration successful!</div>`;
        } else {
          msg.innerHTML = `<div class='alert alert-danger'>${data.message}</div>`;
        }

      } catch (error) {
        msg.innerHTML = `<div class='alert alert-danger'>Something went wrong!</div>`;
      }
    });
  </script>

</body>

</html>
